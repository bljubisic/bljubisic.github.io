<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Explorations"/><link rel="canonical" href="https://bljubisic.github.io/posts/survey-md"/><meta name="twitter:url" content="https://bljubisic.github.io/posts/survey-md"/><meta name="og:url" content="https://bljubisic.github.io/posts/survey-md"/><title>survey-md or How to Make a Survey Out of Markdown | Explorations</title><meta name="twitter:title" content="survey-md or How to Make a Survey Out of Markdown | Explorations"/><meta name="og:title" content="survey-md or How to Make a Survey Out of Markdown | Explorations"/><meta name="description" content="survey-md or How to Make a Survey Out of Markdown"/><meta name="twitter:description" content="survey-md or How to Make a Survey Out of Markdown"/><meta name="og:description" content="survey-md or How to Make a Survey Out of Markdown"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Explorations"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Explorations</a></div></header><div class="wrapper"><article><div class="content"><h1>survey-md or How to Make a Survey Out of Markdown</h1><p>When challange appeared to either use survey framework or to build our own for a project that we were assign to, for me, it was a perfect opprtunity to try and create a survey tool that would use markdown as a underlying format. I quickly tried to find if there was anything on the market that was using the same principle and could only find this, <a href="https://github.com/Fedia/survapp">surv.app</a>. This was the only thing that resembled what I wanted to have in our survey tool. It had simple Markdown extension that allowed easy way of formulating questions and also, it also included few simple question types, like single choice, multiple choice, open ended and number questions. But it had one big disadvantage, it was a node.js app, so server side, and I wanted a framework that we could add to our already existing app. Ok, so I had a task in my hands, to rewrite server side app to a client based framework.</p><h2>Structure of the framework</h2><p>I used svelte for this as the oringinal app was built on svelte so I could re use most of the parts. The main part is of course md.js which I took with minimal changes and also SurveyNode.svelte, SurveyPrint.svelte and SurveyQuestion.svelte. I made small changes to the original files, just to make them suitable for framework usage. Also, I have added new question type, as that was needed for our project, matrix question. Let me walk you through the structure of the project.</p><p>Main action is done in md.js file, which is responsible for parsing the markdown strings and recognizing where the questions are. In addition to general parser, there are three svelte components that are responsible for markdown rendering on the screen. First two are pretty obvious ones, <code></code><code>SurveyNode.svelte</code><code></code> and <code></code><code>SurveyPrint.svelte</code><code></code> responsible for rendering the pure markdown, like paragraph or regular text with markdown syntax. The third one is the one responsible for rendering the question, <code></code><code>SurveyQuestion.svelte</code><code></code>. This is where all the question types resides. Just recently I have added matrix type of the question, which distributes the answers in a matrix type. This was done by introducing new param called matrix with format:</p><pre><code>?question_name matrix='strongly disagree, disagree, agree, strongly agree'
</code></pre><p>after which normal options follows.</p><p>Each question response is stored in context which is essential when setting up the question within your app. When ever you call</p><pre><code>&lt;<span class="type">SurveyNode</span>&gt;
</code></pre><p>you need to add parameters to it:</p><pre><code>&lt;<span class="type">SurveyNode</span> {node} bind:<span class="call">context</span> {next}&gt;
</code></pre><p>Node here is an actuall parsed markdown string, context is js object which at the initialization has an id and started_at properties, and will contain all of the answers in an object <code></code><code>{[question_name]: value}</code><code></code>. Next is an function which will be called when survey needs to move forward with the questions. It is completely empty at the start, and you need to supply the code for it.</p><h3>Question Ruleset</h3><p>As said earlier, questions are marked with markdown extension:</p><pre><code>?question_name options params=value
</code></pre><p>This question mark <code></code><code>?</code><code></code> should always be at the begining of the line imidietely followed by question name. This question name is important later. Right after this definition of question there are two options to continue. In first, when you just enter a line of text like: <code></code><code>This is a placeholder</code><code></code>, that would mean that you have created an open ended question which will result in rendered text input with 'This is a placeholder' as placeholder text. In second, if you enter something like this:</p><pre><code>- <span class="type">Option</span> <span class="number">1</span>
- <span class="type">Option</span> <span class="number">2</span>
- <span class="type">Option</span> <span class="number">3</span>
</code></pre><p>will result in single or multiple choice question and would be rendered either as radio buttons or checkboxes. Matrix questions I have already explained, so we only have left open ended questions which are the simplest one:</p><pre><code>?question_name
placeholder text
</code></pre><h3>How to use it in code</h3><p>Once you have your markdown ready, you need to structure your code to accomodate it. With what I already showed you, it is pretty easy to do. First of all, you need to set up your context which should look like this on initialization:</p><pre><code>   <span class="keyword">let</span> context = {
      uid: <span class="call">uid</span>(),
      started_at: new <span class="type">Date</span>().<span class="call">toISOString</span>().<span class="call">substring</span>(<span class="number">0</span>, <span class="number">19</span>).<span class="call">replace</span>('<span class="type">T</span>', ' ')
    };
</code></pre><p>All of your question responses would reside in Typescript object in format</p><pre><code>context['question_name'] = response
</code></pre><p>Also, you need to provide next fuction which will provide logic for progressing to new page (new question). Prev function can also be provided. In addition to this, within your questions you can have branching options, conditional skipping questions or progressing to the certain question. You don't need to do any of that with the code, all of that is done within markdown scripts. All condition statements begins with the character @ as the first character of the line, followed by javascript expression. If you want to include previous questions, you can do that by writing sometjing like this:</p><pre><code><span class="keyword">@</span> context['question_name'] === response
</code></pre><p>The question, or page will be rendered only if the condition is met. If not, it will be skipped. On one page you can have multiple questions.</p><p>After this you need to add your page, as string, and parse it using md.js. The result of that parsing is fed to the SurveyNode in code that looks something like this:</p><pre><code>&lt;div <span class="keyword">class</span>=<span class="string">"viewport typo"</span>&gt;
{#each data.<span class="property">post</span>.<span class="property">content</span> <span class="keyword">as</span> page, i}
  {<span class="preprocessing">#if i === pageIndex}</span>
    &lt;div
      <span class="keyword">class</span>=<span class="string">"view"</span>&gt;
      &lt;div <span class="keyword">class</span>=<span class="string">"view-body"</span>&gt;
        {#each page.<span class="property">children</span> <span class="keyword">as</span> node}
          &lt;<span class="type">SurveyNode</span> {node} bind:<span class="call">context</span> {next} /&gt;
        {/each}
      &lt;/div&gt;
    &lt;/div&gt;
  {/<span class="keyword">if</span>}
{/each}
&lt;/div&gt;
</code></pre><p>As you can see, each question is viewed as a node and will be separately parsed and rendered on the screen. SurveyNode is responsible for this. You may ask, but where is SurveyQuestion now? Well, SurveyQuestion is called by SurveyNode any time that question is recognized within the markdown string. Same parameters will be passed to it, context and next function.</p><h3>Future of the project</h3><p>So far, I see this project as a open sorced project that shall remain so. In future I could see adding React or Angular support to it, but most interesting for me is moving this kind of rendering of questions to iOS and implementing all of this in Swift. Stay tuned...</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/svelte">Svelte</a></li><li><a href="/tags/markdown">Markdown</a></li><li><a href="/tags/survey">Survey</a></li><li><a href="/tags/typescript">Typescript</a></li><li><a href="/tags/javascript">Javascript</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>